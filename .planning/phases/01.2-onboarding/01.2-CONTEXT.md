# Phase 1.2: onboarding - Context

**Gathered:** 2026-03-01
**Status:** Ready for planning

<domain>
## Phase Boundary

New users can register, create a family, add children, and be ready to use the app within 3 minutes. Covers: full `/login` page, `/register` page, multi-step `/onboarding` wizard (parent flow), and `/onboarding/join` page (child join flow). Does NOT include categories configuration (Phase 1.3) or post-onboarding settings management.

</domain>

<decisions>
## Implementation Decisions

### Auth entry point
- Separate `/login` and `/register` pages (not a combined toggle)
- Google OAuth is primary CTA — big "Continue with Google" button at top
- Email/password is secondary — divider "or", then form below
- Post-login always redirects to `/dashboard` (middleware handles /onboarding redirect if no family)
- Register form is minimal: email + password only — name/profile collected in wizard Step 1

### Onboarding wizard structure
- Single URL `/onboarding` — step tracked in React state (no separate sub-routes)
- Step order: welcome → profile → family → add child → invite parent → categories → done (7 steps)
- Progress bar visible on every step
- Onboarding progress persisted in DB (e.g., `onboarding_step` field) — user resumes from last completed step if they close and return
- "Invite second parent" step included in wizard with "Skip for now" button (not hidden in Settings only)
- Only one child added during onboarding — additional children added from Settings later
- Subtle slide/fade transitions between steps (advancing = slide left, back = slide right)

### Child profile / avatar
- Emoji grid + optional photo upload during onboarding (requires Supabase Storage)
- Preset emoji picker (8–12 options) shown first; photo upload as secondary option

### Invite code UX (parent flow)
- 6-digit invite code is generated per child profile
- Code shown inline after parent saves child profile on the "add child" step — same screen, no separate page
- Copy button + "Share this with your child" message shown before clicking Next
- Code also accessible in Settings > Family > [child name] with copy button (persistent, no expiry)

### Child join flow
- Child registers/logs in with their own account
- Middleware detects no `family_members` record → redirects to `/onboarding/join` (separate from parent wizard)
- `/onboarding/join`: simple code-entry page (6-digit input), not a multi-step wizard
- Code valid → show child's profile preview ("Is this you? [name] [emoji]") → Confirm → `/dashboard`

### Visual tone
- Use existing design system throughout: Inter font, globals.css CSS variables, Tailwind, emerald-500 as primary action color
- One playful exception: brief confetti burst (`canvas-confetti`) on the final "Done" screen only
- No new color palette or gradient backgrounds — onboarding matches app interior

### Claude's Discretion
- Exact step transition animation implementation (CSS vs Framer Motion)
- Loading/skeleton states during async DB saves between steps
- Form validation error message styling
- Exact emoji set for child avatar picker
- Supabase Storage bucket configuration for photo upload

</decisions>

<specifics>
## Specific Ideas

- The wizard feels like a "wizard not a modal" — full page, centered card layout, progress bar at top
- Child join flow should feel lightweight — just a big code-entry input, not a multi-step experience
- Confetti on the done screen is the one fun moment — everything else stays clean

</specifics>

<code_context>
## Existing Code Insights

### Reusable Assets
- `app/login/page.tsx` — stub, replace entirely with full auth UI
- `app/onboarding/welcome/page.tsx` — stub, replace with wizard component
- `app/auth/callback/route.ts` — complete OAuth handler, no changes needed
- `middleware.ts` — complete route guard: unauthenticated → `/login`, no-family → `/onboarding/welcome` (update target to `/onboarding`)
- `lib/store.ts` (Zustand) — global `childId` state; wizard may update this after child is selected
- `lib/supabase/` — browser/server/middleware client factories from Phase 1.1 (ready to use)

### Established Patterns
- All pages are `'use client'`, no server components in app pages
- Styling: mix of Tailwind utilities + custom classes from `globals.css` (premium-*, shadow-md, Inter font)
- CSS variables: `--emerald-500` (primary), `--gray-*` neutrals, `--shadow-md` for cards
- No existing multi-step wizard component — needs to be built from scratch
- No existing auth form UI components (email/password inputs, OAuth button)

### Integration Points
- `middleware.ts` `isOnboardingPath` check — already exempts `/onboarding` from family-membership redirect
- `middleware.ts` `isPublicPath` — already includes `/register` and `/login`
- `app/auth/callback/route.ts` — handles `?code=` exchange and redirects to `/dashboard`
- Supabase `families`, `family_members`, `user_profiles` tables (created in Phase 1.1)
- Supabase Storage — needs bucket for child photo uploads (new, not yet created)
- `onboarding_step` tracking field — needs to be added to `user_profiles` or `families` table (schema addition)

</code_context>

<deferred>
## Deferred Ideas

- None — discussion stayed within phase scope

</deferred>

---

*Phase: 01.2-onboarding*
*Context gathered: 2026-03-01*
