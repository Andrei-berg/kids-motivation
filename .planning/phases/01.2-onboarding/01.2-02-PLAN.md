---
phase: 01.2-onboarding
plan: "02"
type: execute
wave: 2
depends_on: []
files_modified:
  - app/login/page.tsx
  - app/register/page.tsx
autonomous: false
requirements:
  - REQ-ONB-001
  - REQ-AUTH-001
  - REQ-AUTH-002
  - REQ-AUTH-004

must_haves:
  truths:
    - "User can sign in with email + password from /login"
    - "User can register with email + password from /register"
    - "Google OAuth 'Continue with Google' button works on both pages"
    - "Forgot password link sends recovery email"
    - "Unauthenticated landing at / or any protected page redirects to /login"
  artifacts:
    - path: "app/login/page.tsx"
      provides: "Login page with Google OAuth CTA + email/password form"
      min_lines: 80
    - path: "app/register/page.tsx"
      provides: "Registration page with Google OAuth CTA + email/password form"
      min_lines: 80
  key_links:
    - from: "app/login/page.tsx"
      to: "Supabase Auth"
      via: "supabase.auth.signInWithPassword() and supabase.auth.signInWithOAuth()"
      pattern: "signInWithPassword|signInWithOAuth"
    - from: "app/register/page.tsx"
      to: "Supabase Auth"
      via: "supabase.auth.signUp() and supabase.auth.signInWithOAuth()"
      pattern: "signUp|signInWithOAuth"

user_setup:
  - service: supabase-google-oauth
    why: "Google OAuth requires external configuration — Claude cannot access Google Cloud Console or Supabase Dashboard"
    env_vars: []
    dashboard_config:
      - task: "Enable Google provider in Supabase"
        location: "Supabase Dashboard → Authentication → Providers → Google → Enable"
        details: "Requires Google Client ID and Client Secret from Google Cloud Console"
      - task: "Create OAuth 2.0 credentials in Google Cloud Console"
        location: "console.cloud.google.com → APIs & Services → Credentials → Create OAuth 2.0 Client ID"
        details: "Authorized redirect URI: https://<your-project>.supabase.co/auth/v1/callback"
      - task: "Set Site URL in Supabase Auth settings"
        location: "Supabase Dashboard → Authentication → URL Configuration → Site URL"
        details: "Set to http://localhost:3000 for dev, https://kids-motivation.vercel.app for prod"
      - task: "Add redirect URLs"
        location: "Supabase Dashboard → Authentication → URL Configuration → Redirect URLs"
        details: "Add: http://localhost:3000/auth/callback and https://kids-motivation.vercel.app/auth/callback"
---

<objective>
Replace the Phase 1.1 login stub with a complete, production-quality auth UI. Two pages: /login and /register. Both use the established design system. Google OAuth is the primary CTA; email/password is secondary.

Purpose: Gate into the app. Every new user hits one of these pages first.
Output: Functional auth entry points styled to match app design system.
</objective>

<execution_context>
@/Users/andrei/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andrei/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01.2-onboarding/01.2-CONTEXT.md
@app/globals.css
@app/layout.tsx

<interfaces>
<!-- From lib/supabase/client.ts — use in 'use client' pages -->
import { createClient } from '@/lib/supabase/client'
const supabase = createClient()

// Auth methods used in these pages:
supabase.auth.signInWithPassword({ email, password })
// returns { data: { user, session }, error }

supabase.auth.signUp({ email, password })
// returns { data: { user }, error }

supabase.auth.signInWithOAuth({
  provider: 'google',
  options: { redirectTo: `${window.location.origin}/auth/callback` }
})
// redirects browser to Google

supabase.auth.resetPasswordForEmail(email, {
  redirectTo: `${window.location.origin}/auth/callback`
})
// returns { error }

// app/auth/callback/route.ts handles the OAuth redirect — no changes needed
// After successful login, middleware redirects:
//   → /dashboard if user has family_members row
//   → /onboarding if user has no family_members row (new user)

<!-- Design system from app/globals.css -->
CSS variables (use these, do NOT introduce new colors):
  --emerald-500: #10b981  (primary action — buttons, links)
  --emerald-600: #059669  (hover state)
  --gray-50: #f9fafb      (page background)
  --gray-100: #f3f4f6     (card background)
  --gray-200: #e5e7eb     (borders, dividers)
  --gray-500: #6b7280     (muted text)
  --gray-900: #111827     (primary text)
  --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1)
  --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1)
  --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1)
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create app/login/page.tsx — full login page with Google OAuth + email/password</name>
  <files>app/login/page.tsx</files>
  <action>
Replace the stub login page with a full auth page. Layout: centered card (max-w-sm, mx-auto, mt-16 on desktop; full-height on mobile), white card background, Inter font via body (already set in globals.css).

**Structure:**
1. App logo/wordmark at top (simple: "FamilyCoins" text in emerald-500, font-bold text-2xl, or use a ⭐ emoji prefix — Claude's discretion on exact logomark)
2. Heading: "Welcome back" (font-weight 700, gray-900)
3. Subheading: "Sign in to your family account" (gray-500, text-sm)
4. Google OAuth button (PRIMARY — full width, rounded-lg, border border-gray-200, white bg, flex items-center gap-3): Google "G" SVG icon on left, "Continue with Google" text centered. On click: call supabase.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.origin + '/auth/callback' } })
5. Divider: horizontal lines with "or" text in center (gray-400, text-sm)
6. Email input (full width, rounded-lg, border border-gray-200, px-4 py-3, focus:ring-2 focus:ring-emerald-500)
7. Password input (same styling, type="password")
8. "Forgot password?" link (text-sm, emerald-500, text-right, cursor-pointer) — on click: show inline "Enter your email above, then click here" or call resetPasswordForEmail and show success message inline
9. "Sign in" button (full width, emerald-500 bg, white text, rounded-lg, py-3, font-semibold) — on click: call signInWithPassword, on error show error message below button in red-500 text
10. "Don't have an account? Register" link at bottom → /register

State: `email`, `password`, `loading` (boolean), `error` (string|null).

On successful signInWithPassword: router.push('/dashboard'). The middleware will redirect to /onboarding if no family exists.

Error display: small red text below the sign-in button when `error` is set.

Use `useRouter` from 'next/navigation' for navigation. All pages are 'use client'.

Import: `import { createClient } from '@/lib/supabase/client'` — instantiate inside the component (not module-level) since it's a browser client.

Do NOT add a NavBar to login/register pages — these are pre-auth pages.
  </action>
  <verify>
    <automated>cd /Users/andrei/Desktop/kids-motivation && npx tsc --noEmit 2>&1 | grep "login" | head -10; echo "TypeScript check done"</automated>
  </verify>
  <done>app/login/page.tsx: 'use client', Google OAuth button, email/password form, forgot password, link to /register. TypeScript compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Create app/register/page.tsx — registration page with Google OAuth + email/password</name>
  <files>app/register/page.tsx</files>
  <action>
Create app/register/page.tsx (this page does not exist yet — need to mkdir if needed, but Next.js App Router creates routes from folders automatically).

Same centered card layout as login. Mirror the structure but for registration:

1. Logo/wordmark (same as login)
2. Heading: "Create your account" (font-weight 700, gray-900)
3. Subheading: "Start your family's motivation journey" (gray-500, text-sm)
4. Google OAuth button (identical to login page, same handler)
5. Divider "or"
6. Email input
7. Password input (add helper text: "At least 6 characters" — gray-400, text-xs, below input)
8. "Create account" button (emerald-500 bg) — calls supabase.auth.signUp({ email, password }). On success: Supabase sends confirmation email by default, but check Supabase project settings — if email confirmation is disabled (common in dev), user is logged in immediately. Handle both: if user has a session (data.session !== null), router.push('/dashboard'). If no session but no error, show inline message: "Check your email to confirm your account."
9. Error display: red text below button
10. "Already have an account? Sign in" → /login

State: `email`, `password`, `loading`, `error`, `success` (boolean for "check your email" state).

When success=true, hide the form and show: centered message with email icon, "Check your inbox", "We sent a confirmation link to {email}", "Back to sign in" link.

Import createClient from '@/lib/supabase/client'. Use 'use client'.
  </action>
  <verify>
    <automated>cd /Users/andrei/Desktop/kids-motivation && npx tsc --noEmit 2>&1 | grep "register" | head -10; echo "TypeScript check done"</automated>
  </verify>
  <done>app/register/page.tsx: 'use client', Google OAuth button, email/password sign-up form, success state ("check email"), link to /login. TypeScript clean.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Checkpoint: Verify login and register pages work</name>
  <action>Human verification step: visit /login and /register, test OAuth button, test form validation, confirm TypeScript compiles.</action>
  <what-built>Complete auth entry: /login with Google OAuth + email/password, /register with sign-up flow. Both styled to match app design system.</what-built>
  <how-to-verify>
1. Run: `npm run dev`
2. Visit http://localhost:3000/login — verify: Google button visible, email/password form below divider, link to /register
3. Try incorrect credentials → verify red error message appears inline (no page reload)
4. Click "Forgot password?" → verify email is sent (check Supabase Auth logs)
5. Visit http://localhost:3000/register — verify: same layout, "Create account" button, link back to /login
6. Try Google OAuth button (requires Google OAuth configured in Supabase — see user_setup) → verify redirect to Google
7. Run: `npx tsc --noEmit` → 0 errors
  </how-to-verify>
  <resume-signal>Type "approved" once both pages render correctly, or describe visual/functional issues</resume-signal>
</task>

</tasks>

<verification>
- /login: Google OAuth button, email/password form, forgot password, link to /register
- /register: Google OAuth button, email/password sign-up, success state, link to /login
- No NavBar on either page (pre-auth)
- Tailwind + CSS variables from globals.css only (no new color palette)
- TypeScript clean: `npx tsc --noEmit` passes
- Middleware: unauthenticated requests to /dashboard redirect to /login (already working from Phase 1.1)
</verification>

<success_criteria>
1. /login page renders with Google OAuth button and email/password form
2. Email/password login works — successful login navigates to /dashboard
3. /register page renders with matching design
4. Sign-up creates Supabase auth user (verify in Supabase Dashboard → Authentication → Users)
5. Both pages link to each other
6. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01.2-onboarding/01.2-02-SUMMARY.md`
</output>
